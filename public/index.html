<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Karaoke Web ğŸ¤ Host-PC</title>
  <link rel="stylesheet" href="css/style.css" />
</head>

<body>
  <!-- ğŸ”¹ Encabezado -->
  <header>
    <h1>Karaoke Web ğŸ¤</h1>
    <button id="btn-reset-rol" class="btn-secondary">Cambiar rol</button>
  </header>

  <!-- ğŸ”¹ Contenido principal -->
  <main>
    <section class="player">
      <select id="selector-cancion"></select>
      <button id="btn-cargar" class="btn-primary">Cargar canciÃ³n</button>
      <button id="btn-play" class="btn-icon">â–¶ï¸ Play</button>
      <button id="btn-pause" class="btn-icon">â¸ï¸ Pausa</button>
      <button id="btn-mic" class="btn-mic">ğŸ™ï¸ Activar micrÃ³fono</button>
      <audio id="audio" controls></audio>
    </section>

    <section class="afinador">
      <div id="afinador-container">
        <canvas id="canvas-afinacion" width="800" height="180"></canvas>
        <div class="etiquetas">
          <span id="label-actual">â€“ Hz</span>
          <span id="label-estado" class="warn">Conectando...</span>
        </div>
      </div>
    </section>

    <section class="letra">
      <div id="letra-container">
        <p id="letra-actual">ğŸ¤ Canta aquÃ­â€¦</p>
      </div>
    </section>
  </main>

  <!-- ğŸ”¹ Overlay de selecciÃ³n de rol -->
  <div id="role-overlay" class="overlay hidden">
    <div class="role-box">
      <h2>ğŸ­ Selecciona tu rol</h2>
      <p>Elige cÃ³mo quieres participar:</p>
      <div class="role-buttons">
        <button id="btn-host" class="btn-primary">ğŸ™ï¸ Host-PC</button>
        <button id="btn-user2" class="btn-secondary">ğŸ§ Usuario 2</button>
      </div>
      <p class="overlay-note">(Tu elecciÃ³n se guardarÃ¡ automÃ¡ticamente)</p>
    </div>
  </div>

  <!-- ğŸ”¹ Scripts -->
  <script src="/socket.io/socket.io.js"></script>
  <script type="module" src="js/socketClient.js"></script>
  <script type="module" src="js/karaoke.js"></script>
  <script type="module" src="js/script.js"></script>

  <!-- ğŸ”¹ Control del selector de rol -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const overlay = document.getElementById("role-overlay");
      const btnHost = document.getElementById("btn-host");
      const btnUser2 = document.getElementById("btn-user2");
      const btnReset = document.getElementById("btn-reset-rol");

      // Comprobar si ya hay un rol guardado
      const savedRole = localStorage.getItem("karaokeRole");

      if (!savedRole) {
        // No hay rol â†’ mostrar selector
        overlay.classList.remove("hidden");
      } else {
        // Ya hay rol â†’ actuar segÃºn el rol
        overlay.classList.add("hidden");
        if (savedRole === "user2") {
          // Si es Usuario 2, redirigir a user2.html
          window.location.href = "user2.html";
        }
      }

      // SelecciÃ³n de Host
      btnHost.addEventListener("click", () => {
        localStorage.setItem("karaokeRole", "host");
        overlay.classList.add("hidden");
        alert("Has seleccionado: Host-PC ğŸ™ï¸");
        location.reload();
      });

      // SelecciÃ³n de Usuario 2 (redirige)
      btnUser2.addEventListener("click", () => {
        localStorage.setItem("karaokeRole", "user2");
        alert("Has seleccionado: Usuario 2 ğŸ§");
        window.location.href = "user2.html";
      });

      // Reiniciar selecciÃ³n
      btnReset.addEventListener("click", () => {
        localStorage.removeItem("karaokeRole");
        alert("Rol eliminado. Se mostrarÃ¡ el selector al recargar.");
        overlay.classList.remove("hidden");
        location.reload();
      });
    });
  </script>
</body>
</html>
